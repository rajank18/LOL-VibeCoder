# LOLVibeCoder Backend

A Node.js backend service that analyzes GitHub repositories to detect if code is "vibe-coded" - meaning the code was generated by AI/LLMs rather than written by developers.

## Features

- ðŸ” **Repository Analysis**: Clone and analyze GitHub repositories from multiple branches
- ðŸ“Š **Deep Code Analysis**: Traverse through actual code content, not just file counts
- ðŸ¤– **AI Pattern Detection**: Analyze code for AI-generated patterns (generic names, perfect formatting, boilerplate)
- ðŸ§  **LLM Integration**: Use Google Generative AI with code samples for accurate detection
- ðŸŒ¿ **Branch Detection**: Automatically tries main, master, develop, dev, trunk branches
- ðŸš€ **REST API**: Simple Express.js API with `/analyze` endpoint
- ðŸ§¹ **Auto Cleanup**: Automatic temporary file cleanup
- âš¡ **Error Handling**: Robust error handling and fallback scoring

## Quick Start

### 1. Install Dependencies

```bash
cd backend
npm install
```

### 2. Set Up Environment

Copy the example environment file and add your Google API key:

```bash
cp env.example .env
```

Edit `.env` and add your Google API key:
```
GOOGLE_API_KEY=your_google_api_key_here
PORT=3001
```

**Get your Google API key**: Visit [Google AI Studio](https://makersuite.google.com/app/apikey) to generate a free API key.

### 3. Start the Server

```bash
npm start
```

The server will start on `http://localhost:3001`

## API Usage

### Analyze a Repository

```bash
GET /analyze?repo=https://github.com/username/repository
```

**Example:**
```bash
curl "http://localhost:3001/analyze?repo=https://github.com/facebook/react"
```

**Response:**
```json
{
  "aiPatterns": 6,
  "codeStructure": 3,
  "documentation": 5,
  "complexity": 1,
  "highlights": ["High comment ratio", "Perfect project structure (AI-generated)", "Test files present"],
  "overall": 4.0,
  "isVibeCoded": false,
  "verdict": "ðŸ‘¨â€ðŸ’» MIXED - Some AI assistance, mostly human-written",
  "metadata": {
    "repo": "https://github.com/facebook/react",
    "processingTime": "2341ms",
    "analyzedAt": "2024-01-15T10:30:00.000Z",
    "metrics": {
      "totalFiles": 1250,
      "totalLines": 45000,
      "commentsRatio": 0.15,
      "hasReadme": true,
      "hasTests": true
    }
  }
}
```

### Health Check

```bash
GET /health
```

## AI Detection System

The API returns scores (0-10) for four AI detection categories (higher = more AI-generated):

- **aiPatterns** (0-10): Generic names, perfect formatting, repetitive patterns
- **codeStructure** (0-10): Boilerplate code, standard templates, lack of personal style
- **documentation** (0-10): AI-generated comments, generic descriptions
- **complexity** (0-10): Overly complex or suspiciously simple code

Plus:
- **overall** (0-10): Weighted average AI detection score
- **isVibeCoded** (boolean): true if overall >= 6
- **verdict** (string): Fun verdict message
- **highlights** (array): AI detection indicators

## Architecture

```
backend/
â”œâ”€â”€ package.json          # Dependencies and scripts
â”œâ”€â”€ env.example          # Environment variables template
â”œâ”€â”€ index.js             # Main Express server
â””â”€â”€ src/
    â”œâ”€â”€ analyzer.js      # Repository cloning and analysis
    â””â”€â”€ llm.js          # Google Generative AI integration
```

## Dependencies

- **express**: Web framework
- **simple-git**: Git repository operations
- **@google/generative-ai**: Google Generative AI SDK
- **dotenv**: Environment variable management
- **fs-extra**: Enhanced file system operations

## Error Handling

The service includes comprehensive error handling:

- Invalid GitHub URLs return 400 status
- Repository cloning failures return 404 status
- LLM failures fall back to rule-based scoring
- All errors include descriptive messages

## Development

### Running in Development

```bash
npm run dev
```

### Testing the API

```bash
# Test health endpoint
curl http://localhost:3001/health

# Test analysis endpoint
curl "http://localhost:3001/analyze?repo=https://github.com/facebook/react"
```

## Configuration

| Environment Variable | Description | Default |
|---------------------|-------------|---------|
| `GOOGLE_API_KEY` | Google Generative AI API key | Required |
| `PORT` | Server port | 3001 |

## License

MIT
